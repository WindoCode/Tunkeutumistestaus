
# OWASP Top 10

### Broken Access Control
#### M√§√§ritelm√§: Puutteelliset k√§ytt√∂oikeuksien hallintamekanismit.
#### Esimerkki: Hy√∂kk√§√§j√§ voi manipuloida URL-osoitetta p√§√§st√§kseen alueille, joille ei ole oikeutettu.
#### Torjunta:
#### Deny by default: Kaikki k√§ytt√∂oikeudet kiellet√§√§n oletusarvoisesti ja sallitaan vain tietyt toiminnot.
#### Least privilege: K√§ytt√§jille annetaan vain ne oikeudet, jotka ovat v√§ltt√§m√§tt√∂m√§t heid√§n teht√§viens√§ suorittamiseen.
####Perusteellinen k√§ytt√∂oikeuksien m√§√§rittely: Tarkista, ett√§ k√§ytt√∂oikeudet on m√§√§ritelty oikein ja ett√§ niihin ei ole ep√§loogisia aukkoja.
Server-Side Request Forgery (SSRF)
#### M√§√§ritelm√§: Hy√∂kk√§√§j√§ saa palvelimen tekem√§√§n pyynt√∂j√§ mielivaltaisiin URL-osoitteisiin.
#### Esimerkki: Hy√∂kk√§√§j√§ voi saada palvelimen pyyt√§m√§√§n tietoja sis√§isist√§ j√§rjestelmist√§ tai muista palveluista.
#### Torjunta:
  - Verkon segmentointi: Rajoita palvelimen p√§√§sy√§ muihin verkkoihin.
  - Sy√∂tteen puhdistus: Tarkista ja puhdista kaikki k√§ytt√§j√§n sy√∂tt√§m√§ data ennen sen k√§ytt√∂√§.
  - Valkoinen lista: Sallitaan vain tietyt, luotettavat kohteet.
### Insecure Direct Object References (IDOR)
- M√§√§ritelm√§: Hy√∂kk√§√§j√§ voi suoraan k√§ytt√§√§ j√§rjestelm√§n resursseja manipuloimalla URL-osoitteita.
- Esimerkki: Hy√∂kk√§√§j√§ voi p√§√§st√§ k√§siksi muiden k√§ytt√§jien tietoihin muuttamalla ID-numeroa URL-osoitteessa.
####  Torjunta:
  - Abstrahointi: √Ñl√§ paljasta sis√§isi√§ j√§rjestelm√§tietoja suoraan k√§ytt√§jille.
  - Validointi: Tarkista aina, ett√§ k√§ytt√§j√§ll√§ on oikeus k√§ytt√§√§ pyydetty√§ resurssia.
### Path Traversal
#### M√§√§ritelm√§: Hy√∂kk√§√§j√§ voi liikkua hakemistojen v√§lill√§ palvelimella ja p√§√§st√§ k√§siksi tiedostoihin, joihin ei pit√§isi olla p√§√§sy√§.
#### Esimerkki: Hy√∂kk√§√§j√§ voi lukea j√§rjestelm√§n kokoonpanotiedostoja.
#### Torjunta:
- Validointi: Tarkista kaikki tiedostopolut ja est√§ p√§√§syn yl√∂sp√§in hakemistoissa.
- Whitelist: Sallitaan vain tietyt tiedostopolut.
### Server-Side Template Injection
#### M√§√§ritelm√§: Hy√∂kk√§√§j√§ voi sy√∂tt√§√§ koodia, joka suoritetaan palvelimella.
#### Esimerkki: Hy√∂kk√§√§j√§ voi muuttaa sivun ulkoasua tai suorittaa mielivaltaisia komentoja.
#### Torjunta:
- V√§lt√§ dynaamisten tietojen suoraa sis√§llytt√§mist√§ templateihin.
- K√§yt√§ parametrisoituja kyselyit√§.
- Puhdista kaikki k√§ytt√§j√§n sy√∂te ennen sen k√§ytt√∂√§ templateissa.
### Cross-Site Scripting (XSS)
#### M√§√§ritelm√§: Hy√∂kk√§√§j√§ voi injektoida haitallista koodia web-sivulle.
#### Esimerkki: Hy√∂kk√§√§j√§ voi varastaa k√§ytt√§j√§n ev√§steit√§ tai suorittaa muita haitallisia toimintoja.
#### Torjunta:
- Puhdista kaikki k√§ytt√§j√§n sy√∂te: Poista tai pakene kaikki haitalliset merkit.
- K√§yt√§ output encodingia: Muunna haitalliset merkit turvallisiksi HTML-entiteeteiksi.
- K√§yt√§ Content Security Policy (CSP): Rajoita selaimen lataamia resursseja.

## a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Laita ZAP sieppaamaan my√∂s kuvat, niit√§ tarvitaan t√§m√§n kerran kotiteht√§viss√§. Osoita, ett√§ hakupyynn√∂t ilmestyv√§t ZAP:n k√§ytt√∂liittym√§√§n.

### Asensin virtuaalikoneeseen ZAPin tunnilla. (Ladattu https://www.zaproxy.org/download/)
#### Asennus
    wget https://github.com/zaproxy/zaproxy/releases/download/v2.15.0/ZAP_2.15.0_Crossplatform.zip    # Lataus
    unzip ../ZAP_2.15.0_Crossplatform.zip    # Paketin purkaminen
    cd ZAP_2.15.0
    java -jar zap-2.15.0.jar    # Ohjelman ajo

#### Sertifikaation lis√§√§minen
    Tools -> Options -> Network -> Server Certificates -> Save
#### Kuvien lis√§√§minen requesteihin.
    Options -> Display -> Process images

### b) Kettumaista. Asenna "FoxyProxy Standard" Firefox Addon, ja lis√§√§ ZAP proxyksi siihen. K√§yt√§ FoxyProxyn "Patterns" -toimintoa, niin ett√§ vain valitsemasi weppisivut ohjataan Proxyyn.

#### Proxy ladattu my√∂s tunnilla. Lis√§tty firefoxiin ja asetettu seuraavat tiedot proxy-asetuksiin.
    Title ZAP
    Type HTTP
    Hostname localhost
    Port 8080
### PortSwigger Labs. Ratkaise teht√§v√§t. Selit√§ ratkaisusi: mit√§ palvelimella tapahtuu, mit√§ eri osat tekev√§t, miten hy√∂kk√§ys l√∂ytyi, mist√§ vika johtuu. Kannattaa k√§ytt√§√§ ZAPia, vaikka malliratkaisut k√§ytt√§v√§t harjoitusten tekij√§n maksullista ohjelmaa. Malliratkaisun kopioiminen ZAP:n tai selaimeen ei ole vastaus teht√§v√§√§n, vaan ratkaisu ja haavoittuvuuden etsiminen on selitett√§v√§ ja perusteltava.

#### Haaste onnistui helposti. Teht√§v√§annossa kerrottiin, ett√§ chat-lokit ovat turvattomasti haettavissa. Siisp√§ l√§hetin chattiin viestin, sain vastauksen ja latasin lokitiedoston k√§ytt√∂liittym√§st√§

![image](https://github.com/user-attachments/assets/97b117ef-3516-42d6-9ceb-7f0708915d2d)

#### Voimme muuttaa latauslinkki√§, jolloin saamme "1.txt" tiedoston.

![image](https://github.com/user-attachments/assets/2f9d0937-7151-418c-827e-1bba2a9654d0)

#### T√§ten saimme salasanan k√§ytt√∂√∂mme.

### d) File path traversal, simple case
#### Teht√§v√§nannossa kerrottiin, ett√§ tuotteiden kuvien n√§ytt√§misess√§ on haavoittuvuus. 

#### Kokeilin lis√§t√§ /etc/passwd eteen ../ eli k√§ytt√§√§ suhteellista polkua. Kuvaa ei l√∂ytynyt, joten p√§√§tin tarkistella ZAP:ia. 

![image](https://github.com/user-attachments/assets/2556ea55-884b-4036-920a-a7d326f01593)

### e) File path traversal, traversal sequences blocked with absolute path bypass
#### Puolustaja esti liikkumisen hakemistojen v√§lill√§ (../) muuttaen absoluuttisen polun k√§ytt√§misen mahdolliseksi. Nyt voimme siirty√§ ZAP:in puolelle ja l√§hett√§√§ HTML-pyynn√∂n sit√§ kautta, joten saamme oikealla polulla tietoon hakemistopolun.

![image](https://github.com/user-attachments/assets/94fde14d-0d34-4e2d-ac24-cf91e7e1df2f)
![image](https://github.com/user-attachments/assets/a44d9c76-90a2-42cd-bbff-1c9c8cc6683a)


### f) File path traversal, traversal sequences stripped non-recursively
#### T√§ss√§ haasteessa on yritetty est√§√§ hakemistorakenteen selaaminen poistamalla k√§ytt√§j√§n sy√∂tteest√§ ../-merkkijono. Jos kokeilee sy√∂tett√§ ../../../etc/passwd, palvelin poistaisi kaikki ../-osat. PortSwiggerin materiaalin mukaan voi yritt√§√§ k√§ytt√§√§ merkkijonoa ....//. T√§ss√§ tapauksessa strip poistaisi merkit 3-5, jolloin j√§ljelle j√§isi sama merkkijono. T√§m√§ tarkoittaa, ett√§ jos strippi√§ ei k√§ytet√§ useaan kertaan per√§kk√§in, ....// on sama kuin ../."

![image](https://github.com/user-attachments/assets/b33d9953-c1f9-4b6b-be69-4077a44d2195)


#### Ratkaisu: 
![image](https://github.com/user-attachments/assets/0139b1bc-d3e5-4043-bbef-91610d182adf)


### g) Server-side template injection with information disclosure via user-supplied objects
#### Haavoittuvuus l√∂ytyy tuotteen muokkauslomakkeella. Jouduin hieman tarkistelemaan ratkaisua, josta selvisi, ett√§ k√§yt√∂ss√§ on Pythonin Django-framework ja sen muottikieli. Kokeilemme "{%debug%}"-sy√∂tett√§ tekstikentt√§√§n.
-     {{settings.SECRET_KEY}}

![image](https://github.com/user-attachments/assets/90f9083a-5fdb-4c0f-92fa-c45c4c4c1295)

![image](https://github.com/user-attachments/assets/ba015a79-666a-4765-8416-1c55fc95117b)


### h) Basic SSRF against the local server
#### Haavoittuvuus on, l√∂ytyy tuotteen varastom√§√§r√§haussa.
![image](https://github.com/user-attachments/assets/6a705c0c-672a-44c5-ba2f-632569251222)

#### Kuvassa n√§kyy vasemmalla stockApi, joka saa arvokseen urlin. Seuraavaksi muutamme funktion stockApi=http://localhost/admin.

![image](https://github.com/user-attachments/assets/a8b3c707-73ac-47df-a362-e375f103e089)


### i) Reflected XSS into HTML context with nothing encoded
#### T√§ss√§ haasteessa on saatava varoitusikkuna n√§kyviin, laittamalla hakukentt√§√§n teksti√§. Saamme varoitusikkunan auki laittamalla sy√∂tteeseen <script>alert()</script> . En ole sataprosenttisen varma, miten hy√∂kk√§ys toimii t√§ss√§ tapauksessa.

![image](https://github.com/user-attachments/assets/be01e784-fad3-4370-b971-bdca8918930e)

### j) Stored XSS into HTML context with nothing encoded

## UPDATE 4:04 Torstai: Viimeinen kohta t√§yttyy torstain aikana, aikatauluongelmia ty√∂n ja kurssin kanssa. üíÄ
